# -*- mode: ruby -*-
# vi: set ft=ruby :
PUBLIC_HOST="HOSTNAME"

# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!
VAGRANTFILE_API_VERSION = "2"

Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
  # All Vagrant configuration is done here. The most common configuration
  # options are documented and commented below. For a complete reference,
  # please see the online documentation at vagrantup.com.

  config.vm.network "private_network", type: "dhcp"
  config.vm.hostname = "#{PUBLIC_HOST}" 


  config.vm.network "private_network", type: "dhcp"

  config.landrush.enabled = true
  config.landrush.tld = ".dev"
  config.landrush.guest_redirect_dns = false

  config.vm.provider "virtualbox" do |v|
    v.memory = 1024
  end

  # Every Vagrant virtual environment requires a box to build off of.
  config.vm.box = "ubuntu/trusty64"
  config.vm.provision :shell, inline: <<-SHELL
    sudo debconf-set-selections <<< 'mysql-server mysql-server/root_password password root'
    sudo debconf-set-selections <<< 'mysql-server mysql-server/root_password_again password root'

    apt-get update
    apt-get install -y apache2 mysql-server mysql-client php5 php5-mysql

    php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
    php -r "if (hash_file('SHA384', 'composer-setup.php') === 'e115a8dc7871f15d853148a7fbac7da27d6c0030b848d9b3dc09e2a0388afed865e6a3d6b3c0fad45c48e2b5fc1196ae') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
    php composer-setup.php
    php -r "unlink('composer-setup.php');"
    mv composer.phar /bin/composer

    # sed /etc/apache2/envvars for right users
    # create database

    # fill database
    # create and run composer with wordpress
    # move wp-config up one level
    # move wp-content up one level
    # sed wp-config for new constants
    # change database

    # remove all unnesessarily themes
    # create a new one (underscore for example)

    # change override option in apache.conf

    # install sass ?

    rm -rf /var/www/html
    ln -s /vagrant /var/www/html

    service apache2 restart
  SHELL
end
